!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueEventBus=t()}(this,function(){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(e){return"[object String]"==Object.prototype.toString.call(e)}function s(e){return{name:(e=e.split("."))[0],namespaceList:e.slice(1).sort()}}function c(e){return RegExp("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)")}function m(e){"[object Array]"!=Object.prototype.toString.call(e)&&(e=[l(l)?e:e+""]);var t=!0,n=!1,r=void 0;try{for(var i,o=e.entries()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=d(i.value,2);e[a[0]]=s(a[1])}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return e}function b(e,t){return e.has(t)?e.get(t):null}var y=function(){function e(){i(this,e),o(this,"entries",new Map)}return n(e,[{key:"on",value:function(e,t,n){var r=2<arguments.length&&void 0!==n&&n;if(e){e=m(e);var i,o,a,l=!0,s=!1,c=void 0;try{for(var u,f=e[Symbol.iterator]();!(l=(u=f.next()).done);l=!0){var h=u.value;if(h.name)(a=void 0,a=null,(i=this.entries).has(o=h.name)?a=i.get(o):(a=new v(o),i.set(o,a)),a).addCallback(h.namespaceList,t,r)}}catch(e){s=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(s)throw c}}return this}}},{key:"once",value:function(e,t){this.on(e,t,!0)}},{key:"off",value:function(e,t){var n,r;if(1===arguments.length?n=0<arguments.length?e:void 0:2==arguments.length&&(n=0<arguments.length?e:void 0,r=1<arguments.length?t:void 0),!n)return this.entries.clear();n=m(n);var i=!0,o=!1,a=void 0;try{for(var l,s=n[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var c=l.value;if(c.name){var u=b(this.entries,c.name);u&&u.removeCallback(c.namespaceList,r)}else if(c.namespaceList){var f=!0,h=!1,y=void 0;try{for(var v,p=this.entries[Symbol.iterator]();!(f=(v=p.next()).done);f=!0){d(v.value,2)[1].removeCallback(c.namespaceList,r)}}catch(e){h=!0,y=e}finally{try{f||null==p.return||p.return()}finally{if(h)throw y}}}}}catch(e){o=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return this}},{key:"trigger",value:function(e){if(e&&(e=s(e)).name){var t=b(this.entries,e.name);if(t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.fire.apply(t,[e.namespaceList].concat(r))}return this}}}]),e}(),v=function(){function t(e){i(this,t),o(this,"_listeners",void 0),o(this,"_name",void 0),this._name=e}return n(t,[{key:"addCallback",value:function(e,t,n){var r=2<arguments.length&&void 0!==n&&n;this.listeners.unshift(new a(t,e.join("."),r))}},{key:"removeCallback",value:function(e,t){for(var n=e.length&&c(e),r=this.listeners.length-1;0<=r;r--)n&&!n.test(this.listeners[r].namespaces)||t&&this.listeners[r].callback!==t||this.listeners.splice(r,1)}},{key:"fire",value:function(e){for(var t=e.length&&c(e),n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=this.listeners.length-1;0<=o;o--){var a;if(!t||t.test(this.listeners[o].namespaces))(a=this.listeners[o]).callback.apply(a,r),this.listeners[o].once&&this.listeners.splice(o,1)}}},{key:"listeners",get:function(){return void 0===this._listeners&&(this._listeners=[]),this._listeners}},{key:"name",get:function(){return this._name}}]),t}(),a=function(){function r(e,t,n){i(this,r),o(this,"_callback",void 0),o(this,"_once",void 0),o(this,"_namespaces",void 0),this._callback=e,this._once=n,this._namespaces=t}return n(r,[{key:"callback",get:function(){return this._callback}},{key:"once",get:function(){return this._once}},{key:"namespaces",get:function(){return this._namespaces}}]),r}(),p=function(e){return"[object Array]"==Object.prototype.toString.call(e)};function g(e){return"."+"xxxxyyyyxy".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var k=!1;return{install:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},r=n.log,i=n.createNamespace,l=void 0===i?g:i;k=void 0!==r&&r;var s=new y;function o(e){for(var o=l(e),t={$emit:function(){return s.trigger.apply(s,arguments),this},namespace:o,core:s},n=function(){var i=a[r];t[i[0]]=function(e,t){var n,r;return s[i[1]]((n=o,(r=e)?(p(r)||(r=[r]),r.map(function(e){return e+n})):r),t),this}.bind(t)},r=0,a=[["$on","on"],["$off","off"],["$once","once"]];r<a.length;r++)n();return e.$on("hook:beforeDestroy",function(){!function(e){var t;if(k){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console)[e].apply(t,r)}}("log","hook:beforeDestroy:clean all listeners on current instance"),t.$off("")}),t}function a(e){return e[f]||(e[f]=o(e)),e[f]}var c="$eventBus",u=Object.getOwnPropertyDescriptor(e.prototype,c),f=Symbol("eventBus"),h={configurable:!0,enumerable:!1,get:function(){return this===e.prototype?s:a(this)}};s.noConflict=function(){return delete s.noConflict,u?Object.defineProperty(e.prototype,c,u):delete e.prototype[c],a},Object.defineProperty(e.prototype,c,h)}}});
