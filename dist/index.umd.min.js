!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).VueEventBus=t()}(this,function(){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw o}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e){return"[object String]"==Object.prototype.toString.call(e)}function u(e){return{name:(e=e.split("."))[0],namespaceList:e.slice(1).sort()}}function s(e){return RegExp("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)")}function y(e){"[object Array]"!=Object.prototype.toString.call(e)&&(e=[c(c)?e:e+""]);var t=!0,n=!1,r=void 0;try{for(var i,o=e.entries()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=l(i.value,2);e[a[0]]=u(a[1])}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return e}function f(e,t){return e.has(t)?e.get(t):null}var v=function(){function e(){i(this,e),o(this,"entries",new Map)}return n(e,[{key:"on",value:function(e,t,n){var r=2<arguments.length&&void 0!==n&&n;if(e){e=y(e);var i,o,a,l=!0,c=!1,u=void 0;try{for(var s,f=e[Symbol.iterator]();!(l=(s=f.next()).done);l=!0){var h=s.value;(a=void 0,a=null,(i=this.entries).has(o=h.name)?a=i.get(o):(a=new p(o),i.set(o,a)),a).addCallback(h.namespaceList,t,r)}}catch(e){c=!0,u=e}finally{try{l||null==f.return||f.return()}finally{if(c)throw u}}return this}}},{key:"once",value:function(e,t){this.on(e,t,!0)}},{key:"off",value:function(e,t){var n,r;if(1===arguments.length?n=0<arguments.length?e:void 0:2==arguments.length&&(n=0<arguments.length?e:void 0,r=1<arguments.length?t:void 0),!n)return this.entries.clear();n=y(n);var i=!0,o=!1,a=void 0;try{for(var l,c=n[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var u=l.value,s=f(this.entries,u.name);s&&s.removeCallback(u.namespaceList,r)}}catch(e){o=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw a}}return this}},{key:"trigger",value:function(e){if(e){e=u(e);var t=f(this.entries,e.name);if(t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.fire.apply(t,[e.namespaceList].concat(r))}return this}}}]),e}(),p=function(){function t(e){i(this,t),o(this,"_listeners",void 0),o(this,"_name",void 0),this._name=e}return n(t,[{key:"addCallback",value:function(e,t,n){var r=2<arguments.length&&void 0!==n&&n;this.listeners.push(new a(t,e.join("."),r))}},{key:"removeCallback",value:function(e,t){for(var n=e.length&&s(e),r=this.listeners.length-1;0<=r;r--)n&&!n.test(this.listeners[r].namespaces)||t&&this.listeners[r].callback!==t||this.listeners.splice(r,1)}},{key:"fire",value:function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=[],o=e.length&&s(e);if(this.listeners.forEach(function(e,t){o&&!o.test(e.namespaces)||(e.callback.apply(e,n),e.once&&i.push(t))}),i.length)for(var a=0,l=0,c=i;l<c.length;l++){this.listeners.splice(c[l]-a,1),a+=1}}},{key:"listeners",get:function(){return void 0===this._listeners&&(this._listeners=[]),this._listeners}},{key:"name",get:function(){return this._name}}]),t}(),a=function(){function r(e,t,n){i(this,r),o(this,"_callback",void 0),o(this,"_once",void 0),o(this,"_namespaces",void 0),this._callback=e,this._once=n,this._namespaces=t}return n(r,[{key:"callback",get:function(){return this._callback}},{key:"once",get:function(){return this._once}},{key:"namespaces",get:function(){return this._namespaces}}]),r}(),g=function(e){return"[object Array]"==Object.prototype.toString.call(e)};function d(e){return"."+"xxxxyyyyxy".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var b=!1;return{install:function(e,t){var n=1<arguments.length&&void 0!==t?t:{},r=n.log,i=n.createNamespace,l=void 0===i?d:i;b=void 0!==r&&r;var c=new v;function o(e){for(var o=l(e),t={$emit:function(){return c.trigger.apply(c,arguments),this},namespace:o,core:c},n=function(){var i=a[r];t[i[0]]=function(e,t){var n,r;return c[i[1]]((n=o,(r=e)?(g(r)||(r=[r]),r.map(function(e){return e+n})):r),t),this}.bind(t)},r=0,a=[["$on","on"],["$off","off"],["$once","once"]];r<a.length;r++)n();return e.$on("hook:beforeDestroy",function(){!function(e){var t;if(b){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console)[e].apply(t,r)}}("log","hook:beforeDestroy:clean all listeners on current instance"),t.$off(o)}),t}function a(e){return e[f]||(e[f]=o(e)),e[f]}var u="$eventBus",s=Object.getOwnPropertyDescriptor(e.prototype,u),f=Symbol("eventBus"),h={configurable:!0,enumerable:!1,get:function(){return this===e.prototype?c:a(this)}};c.noConflict=function(){return delete c.noConflict,s?Object.defineProperty(e.prototype,u,s):delete e.prototype[u],a},Object.defineProperty(e.prototype,u,h)}}});
